<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fixing GitHub Pages Custom Domain Redirect Loop - Bin Huang's Blog</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <nav>
                <ul>
                    <li><a href="/">Home</a></li>
                    <li><a href="/#about">About</a></li>
                    <li><a href="/#blogs">Blogs</a></li>
                    <li><a href="/#contact">Contact</a></li>
                </ul>
            </nav>
        </header>

        <main>
            <article class="blog-post">
                <h1>Fixing GitHub Pages Custom Domain Redirect Loop</h1>
                <p class="post-date">March 2, 2025</p>
                <div class="post-content">
                    <h2>Problem Description</h2>
                    <p>While migrating my personal website from Squarespace to GitHub Pages and configuring a custom domain, I encountered a redirect loop issue. The website was stuck in an infinite redirect loop between the www and non-www versions.</p>

                    <h2>Root Cause</h2>
                    <p>After investigation, the issue was traced to DNS configuration:</p>

                    <h3>Understanding DNS Basics</h3>
                    <p>Before diving into the solution, it's helpful to understand how DNS (Domain Name System) works:</p>

                    <div class="diagram">
                        <h4>DNS Resolution Process</h4>
                        <pre class="ascii-diagram">
User                DNS Server           GitHub Pages
 |                      |                     |
 |   binhuang.dev?     |                     |
 |-------------------→ |                     |
 |                     |                     |
 |                     |  [DNS Lookup]       |
 |                     |  A record → IP      |
 |                     |                     |
 |    IP Address       |                     |
 | ←------------------ |                     |
 |                     |                     |
 |         HTTP Request to IP               |
 |-------------------------------------→    |
 |                     |                    |
 |         Website Content                  |
 | ←------------------------------------- |</pre>
                    </div>

                    <ul>
                        <li>DNS is like the internet's phone book, translating human-readable domain names into IP addresses</li>
                        <li>Different types of DNS records serve different purposes:
                            <ul>
                                <li>A records: Direct mapping of a domain to IP addresses</li>
                                <li>CNAME records: Alias one domain name to another domain name</li>
                            </ul>
                        </li>
                        <li>The apex domain (e.g., example.com) and www subdomain (www.example.com) are technically different and can be configured differently</li>
                    </ul>

                    <h3>WWW vs Non-WWW Domains</h3>
                    <div class="diagram">
                        <h4>DNS Record Types Comparison</h4>
                        <pre class="ascii-diagram">
┌─────────────────────────┐      ┌──────────────────────┐
│    Apex (binhuang.dev)  │      │  www.binhuang.dev    │
├─────────────────────────┤      ├──────────────────────┤
│    A Records (Direct)   │      │   CNAME (Flexible)   │
├─────────────────────────┤      ├──────────────────────┤
│ → 185.199.108.153      │      │ → github.io          │
│ → 185.199.109.153      │      │   (Can change IPs    │
│ → 185.199.110.153      │      │    without updating  │
│ → 185.199.111.153      │      │    DNS)              │
└─────────────────────────┘      └──────────────────────┘</pre>
                    </div>

                    <h3>The Redirect Loop Problem</h3>
                    <div class="diagram">
                        <h4>Initial Problematic Configuration</h4>
                        <pre class="ascii-diagram">
┌──────────────┐     ┌───────────────┐     ┌──────────────┐
│              │     │               │     │              │
│ binhuang.dev │ →   │  Squarespace  │  →  │    www.     │
│              │     │               │     │              │
└──────────────┘     └───────────────┘     └──────────────┘
       ↑                                           │
       │                                          │
       │              ┌───────────────┐           │
       │              │               │           │
       └────────────  │ GitHub Pages  │ ←─────────┘
                      │               │
                      └───────────────┘</pre>
                    </div>

                    <p>This difference in DNS record types between www and non-www domains is crucial for understanding why we need different configurations for each.</p>

                    <h2>The Problem</h2>
                    <ul>
                        <li>The apex domain (binhuang.dev) was still pointing to Squarespace servers</li>
                        <li>The www subdomain (www.binhuang.dev) was already pointing to GitHub Pages</li>
                        <li>This resulted in the following loop:
                            <pre>
binhuang.dev → Squarespace → www.binhuang.dev 
→ GitHub Pages → binhuang.dev → loop continues...</pre>
                        </li>
                    </ul>

                    <h2>Solution</h2>
                    <p>To resolve this issue, the following steps were required:</p>
                    <ol>
                        <li>Disconnect from Squarespace:
                            <ul>
                                <li>Log into Squarespace account</li>
                                <li>Remove all domain-related settings</li>
                            </ul>
                        </li>
                        <li>Update DNS Records:
                            <ul>
                                <li>Set A records pointing to GitHub Pages IPs:
                                    <pre>
A Records:
Host: @ or empty
Values: 185.199.108.153
        185.199.109.153
        185.199.110.153
        185.199.111.153</pre>
                                </li>
                                <li>Set CNAME record:
                                    <pre>
CNAME Record:
Host: www
Value: your-github-username.github.io</pre>
                                </li>
                            </ul>
                        </li>
                        <li>Configure GitHub Pages:
                            <ul>
                                <li>Set Custom domain to apex domain in repository settings</li>
                                <li>Ensure CNAME file content is correct</li>
                            </ul>
                        </li>
                        <li>Wait for DNS Propagation:
                            <ul>
                                <li>DNS changes may take up to 24 hours to propagate</li>
                                <li>Monitor changes using dig command</li>
                            </ul>
                        </li>
                    </ol>

                    <h2>Verification</h2>
                    <p>Use these commands to verify the configuration:</p>
                    <pre>
# Check A records
dig +noall +answer binhuang.dev

# Check CNAME record
dig +noall +answer www.binhuang.dev

# Check HTTP responses
curl -I https://binhuang.dev
curl -I https://www.binhuang.dev</pre>

                    <h2>Important Notes</h2>
                    <ul>
                        <li>Remove all old DNS records to avoid conflicts</li>
                        <li>Website might be temporarily inaccessible during DNS propagation</li>
                        <li>If using HTTPS, wait for certificate configuration to complete</li>
                    </ul>
                </div>
            </article>
        </main>

        <footer>
            <p>© 2025 Bin Huang's Blog. All rights reserved.</p>
        </footer>
    </div>
</body>
</html> 